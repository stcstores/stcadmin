{% for supplier, products in suppliers.items %}
    <h4>{{ supplier.name }}</h4>
    <table>
        <thead>
            <tr>
                <th>SKU</th>
                <th>Barcode</th>
                <th>Purchase Price</th>
                <th>Re-Order</th>
                <th>Stock Level</th>
                <th>Comment</th>
                <th>Additional Suppliers</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
                <tr>
                    <td>
                        <p class="sku">{{ product.sku }}</p>
                        <p class="name">{{ product.product_range.name }}</p>
                        <p>
                            {% for value in product.variation_values %}<span>{{ value }}</span>{% endfor %}
                        </p>
                    </td>
                    <td class="sku">{{ product.barcode }}</td>
                    <td>
                        <input type="text"
                               value="{{ product.purchase_price }}"
                               size="6"
                               class="purchase_price_input"
                               id="purchase_price_input_{{ product.id }}"
                               data-product_id="{{ product.id }}"
                               onclick="this.select()">
                        <span class="purchase_price_status"
                              id="purchase_price_status_{{ product.id }}">
                            <i class="fa-solid fa-check"></i>
                        </span>
                    </td>
                    <td>
                        <input type="text"
                               value="0"
                               size="2"
                               class="order_count_input"
                               id="order_count_input_{{ product.id }}"
                               data-product_id="{{ product.id }}"
                               onclick="this.select()">
                        <button class="ordered_button"
                                id="ordered_button_{{ product.id }}"
                                data-product_id="{{ product.id }}">Ordered</button>
                        <span class="order_count_status" id="order_count_status_{{ product.id }}">
                            <i class="fa-solid fa-check"></i>
                        </span>
                    </td>
                    <td>
                        {% if product_range.is_end_of_line or product.is_end_of_line %}
                            <span class="error">Stock levels are not available for EOL products</span>
                        {% else %}
                            {% include "inventory/update_stock.html" %}
                        {% endif %}
                    </td>
                    <td>
                        <textarea name="comment"
                                  id="comment_{{ product.id }}"
                                  class="comment_input"
                                  cols="30"
                                  rows="1"
                                  data-product_id="{{ product.id }}"></textarea>
                        <span class="comment_status" id="comment_status_{{ product.id }}">
                            <i class="fa-solid fa-check"></i>
                        </span>
                    </td>
                    <td>
                        {% for supplier in product.additional_suppliers.all %}
                            <p>
                                <small>{{ supplier }}</small>
                            </p>
                        {% endfor %}
                    </td>
                    <td>
                        <button onclick="window.open('{% url 'fba:create_order' product_id=product.id %}');">Create FBA Order</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

{{ reorder_counts|json_script:"reorderCounts" }}
{{ comments|json_script:"reorderComments" }}
