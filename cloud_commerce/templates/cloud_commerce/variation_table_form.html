{% extends "cloud_commerce/variation_wizard.html" %}
{% load staticfiles %}
{% load stcadmin_extras %}

{% block table_class %}variation_table{% endblock %}

{% block additional_head %}{{ block.super }}
<script src="{% static 'scripts/price_field.js' %}"></script>
{% endblock %}

{% block formset %}
    <tr>
        {% for field in wizard.form.forms.0 %}
            <th>{{ field.label }}&nbsp;{% tooltip_help_text field %}</th>
        {% endfor %}
    </tr>
    {% for form in wizard.form.forms %}
        <tr>
            {% for field in form %}
                <td>{{ field }}{% if field.errors %}<p class="error">{{ field.errors }}</p>{% endif %}</td>
            {% endfor %}
        </tr>
    {% endfor %}
{% endblock %}

{% block script %}{{ block.super}}
<script>
    $(document).ready(function() {
        {% for form in wizard.form.forms %}
            price_field_{{ forloop.counter }} =  new PriceField($('#{{ form.price.auto_id }}'));

            $('#{{ form.vat_rate.auto_id }}').change(function () {
                var value = $(this).val();
                if (value === '') {
                    var vat_rate = false;
                } else {
                    var vat_rate = parseInt(value);
                }
                price_field_{{ forloop.counter }}.set_vat_rate(vat_rate);
            });

            $('#{{ form.vat_rate.auto_id }}').change();
        {% endfor %}
    });
</script>
{% endblock %}
