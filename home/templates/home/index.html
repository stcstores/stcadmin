{% extends "home/base.html" %}
{% load staticfiles %}
{% block page_title %}STC Admin{% endblock %}
{% block content %}
    <h1>STC Admin</h1>
    <div class="site_index">
        <p>From here you can access:</p>
        <ul class='app'>
            <li><a href="{% url 'reference:index' %}">Reference</a></li>
            <p>Access reference material.</p>
            {% for group in request.user.groups.all %}{% if group.name == 'cloud_commerce' %}
                <li><a href="{% url 'cloud_commerce:index' %}">Cloud Commerce</a></li>
                <p>Tools for working with Cloud Commerce</p>
                <ul class="section">
                    <li><a href="{% url 'cloud_commerce:new_product' %}">Manifest</a></li>
                    <p>Create a new <a href="{% url 'cloud_commerce:new_single_product' %}">single</a> or <a href="{% url 'cloud_commerce:new_variation_product' %}">variation</a> product.</p>
                    <li><a href="{% url 'cloud_commerce:sku_generator' %}">SKU Generator</a></li>
                    <p>Get unused SKUs for Cloud Commerce products or product ranges.</p>
                </ul>
            {% endif %}{% endfor %}
            {% for group in request.user.groups.all %}{% if group.name == 'epos' %}
                <li><a href="{% url 'epos:index' %}">EPOS</a></li>
                <p>Access the EPOS.</p>
            {% endif %}{% endfor %}
            {% for group in request.user.groups.all %}{% if group.name == 'suppliers' %}
                <li><a href="{% url 'suppliers:index' %}">Suppliers</a></li>
                <p>Manage supplier lists.</p>
            {% endif %}{% endfor %}
            {% for group in request.user.groups.all %}{% if group.name == 'labelmaker' %}
                <li><a href="{% url 'labelmaker:index' %}">Labelmaker</a></li>
                <p>Make printable product labels.</p>
            {% endif %}{% endfor %}
            {% for group in request.user.groups.all %}{% if group.name == 'admin' %}
                <li><a href="/admin/">Admin</a></li>
                <p>Tools for administering STC Admin.</p>
                <ul class="section">
                    <li>View and edit database tables.</li>
                    <li>Manage users and groups.</li>
                </ul>
            {% endif %}{% endfor %}
        </ul>
    </div>
    <div class="homepage_feedback">
        <table class="feedback" id="feedback">

        </table>
    </div>
{% endblock %}

{% block script %}{{ block.super }}
<script>
    function get_feedback() {
        $('.feedback').html('');
        $.get("{% url 'print_audit:feedback_monitor' %}",
            function(data) {
                var data = $.parseJSON(data);
                for (var i=0; i<data.length; i++) {
                    var name = data[i]['name'];
                    $('#feedback').append('<tr id="feedback_' + i + '"><th class="feedback_name">' + name + ': </th><td class="feedback_icons">');
                    $.each(data[i].feedback, function(index, feedback) {
                        for (im=0; im<feedback.count; im++) {
                            $('#feedback_' + i).children('.feedback_icons').append('<img src="' + feedback.image_url + '" height="40">');
                        }
                    });
                }
                current = 'feedback'
            }
        );
    }

    $(document).ready(function() {get_feedback();});
</script>
{% endblock %}
