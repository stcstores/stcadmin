{% extends "labelmaker/base.html" %}
{% load staticfiles %}

{% block content %}
    <div id="size_chart_label_setup" class="size_chart_label_setup">
        <div id="add_product_code" class="form_section">
            <p class="form_section_header">Product Code</p>
            <input type="text" id="product_code" name="product_code">
        </div>
        <div id="add_sizes" class="form_section">
            <p class="form_section_header">Size</p>
            {% for size in sizes %}

            <input class="size_checkbox" type="checkbox" name="size_{{size.id}}" value="{{size.id}}">
            <label for="size_{{size.id}}">{% if size.name.strip %}{{size.name.strip}}{% else %}UK: {{ size.uk_size }}{% endif %}</label><br>{% endfor %}
        </div>
        <div id="add_colours" class="form_section"></div>
        <br>
        <button id="create_table_button">Create Table</button>
        <div id="selection_table"></div>
        <form action="{% url 'labelmaker:generate_pdf_for_size_chart' size_chart_id=size_chart.id %}" method="POST" id="label_selection_form" class="hidden">
            {% csrf_token %}
            <input type="text" name="data" id="data">
        </form>
    </div>
    <script>
        $( document ).ready(function() {
            size_data = {
                {% for size in sizes %}{{size.id}}: {{size.uk_size}},
                {% endfor %}
            }

            var colour_list = LabelForm($('#add_colours'), ['colour']);

            get_sizes = function() {
                var sizes = [];
                $('.size_checkbox').each(function() {
                    if ($(this).is(':checked')) {
                        var ref = $(this).val();
                        var name = $(this).next("label").text();
                        sizes.push([ref, name]);
                    }
                });
                return sizes.sort();
            };

            get_colours = function() {
                return colour_list['colour'].get_list().sort();
            };

            var create_table_button = $('#create_table_button');
            create_table_button.click(function() {
                var data = {
                    sizes: get_sizes(),
                    colours: get_colours()
                }
                var form = $('#label_selection_form');
                var table = LabelSelectionTable($('#selection_table'), data, form);
                return table;
            })
        });
    </script>{% endblock %}
