{% load staticfiles %}
<html>
    <head>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    </head>
    <body>
        <style>

            #pack_count, #feedback {
                clear: both;
                margin: 0 auto;
            }

            .feedback_name, .packer_name {
                text-align: right;
                padding-right: 0.25em;
            }

            .feedback_icons, .packer_count {
                text-align: left;
                padding-left: 0.25em;
                font-size: 6em;
            }

            .feedback_name {
                font-size: 3.5em;
            }

            .packer_name {
                font-size: 6em;
            }

            .score {
                font-size: 3em;
                font-family: monospace;
            }

            .positive {
                color: green;
            }

            .negative {
                color: red;
            }

        </style>

        <button class="toggle">Toggle</button>&nbsp;
        <label for="auto_toggle">Auto Toggle</label><input type="checkbox" name="auto_toggle" class="auto_toggle" checked>

        <div>
            <table class="pack_count" id="pack_count">

            </table>
            <table class="feedback" id="feedback">

            </table>
        </div>


        <script>
            auto_toggle = true;
            current = '';

            function get_pack_count() {
                $('.pack_count').html('');
                $('.feedback').html('');
                $.get("{% url 'print_audit:pack_count_monitor' %}",
                    function(data) {
                        var data = $.parseJSON(data);
                        for (var i=0; i<data.length; i++) {
                            var name = data[i][0]
                            var count = data[i][1]
                            $('#pack_count').append('<tr><th class="packer_name">' + name + '</th><td class="packer_count">' + count + '</td></tr>');
                        }
                        current = 'pack_count'
                    }
                );
            }

            function get_feedback() {
                $('.pack_count').html('');
                $('.feedback').html('');
                $.get("{% url 'print_audit:feedback_monitor' %}",
                    function(data) {
                        var data = $.parseJSON(data);
                        for (var i=0; i<data.length; i++) {
                            var name = data[i]['name'];
                            var score = data[i]['score'];
                            $('#feedback').append('<tr id="feedback_' + i + '"><th class="feedback_name">' + name + ': </th><th class="score">' + score + '</th><td class="feedback_icons">');
                            $.each(data[i].feedback, function(index, feedback) {
                                for (im=0; im<feedback.count; im++) {
                                    $('#feedback_' + i).children('.feedback_icons').append('<img src="' + feedback.image_url + '" height="40">');
                                }
                            });
                        }
                        $('.score').each(function() {
                            var score = parseInt($(this).text());
                            if (score > 0){
                                $(this).addClass('positive');
                            } else if (score < 0) {
                                $(this).addClass('negative');
                            }
                        });
                        current = 'feedback'
                    }
                );
            }

            function toggle() {
                if (current == 'pack_count') {
                    get_feedback();
                } else {
                    get_pack_count();
                }
            }

            if (auto_toggle) {
                setInterval(function(){
                    if ($('.auto_toggle').is(':checked')) {
                        toggle();
                    }
                }, 1000 * 30);
            }

            $(document).ready(function() {
                get_pack_count();
                $('.toggle').click(function() {
                    toggle();
                });
            });

        </script>
    </body>
</html>
