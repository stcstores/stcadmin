{% extends "inventory/base.html" %}
{% load staticfiles %}
{% load inventory_extras %}
{% load stcadmin_extras %}

{% block additional_head %}
{{ block.super }}
<script src="{% static 'scripts/stock_manager.js' %}"></script>
{% endblock %}

{% block page_title %}CCP New Product Success{% endblock %}

{% block content %}
    <h2>{{ product_range.name }}</h2>
    <p>SKU: {{ product_range.sku}}</p>
    <p>ID: {{ product_range.id }}</p>
    <a href="{% ccp_product_range_page product_range.id %}" target="_blank"><button>View Range on Cloud Commerce</button></a>
    <a href="{% url 'inventory:variations' product_range.id %}"><button>Variations</button></a>
    <a href="{% url 'inventory:descriptions' product_range.id %}"><button>Descriptions</button></a>
    <a href="{% url 'inventory:locations' product_range.id %}"><button>Locations</button></a>
    <a href="{% url 'inventory:images' product_range.id %}"><button>Images</button></a>
    <a href="{% url 'price_calculator:range_price_calculator' product_range.id %}"><button>Price Calculator</button></a>
    <a href="{% url 'inventory:print_barcodes' product_range.id %}"><button>Print Barcodes</button></a>
    <form action="" method="POST">{% csrf_token %}
        <table>
            {% for field in form %}
            <tr>
                <td>{{ field.label }}</td>
                <td>{{ field }}</td>
                <td>{% tooltip_help_text field %}</td>
                {% if field.errors %}
                    <td class="error">{{ field.errors }}</td>
                {% endif %}
            </tr>
            {% endfor %}
            <tr><td colspan="3"><input type="submit" value="Update"></td></tr>
        </table>
    </form>
    <div class="product_list">
        <h3>Products</h3>
        <table class="product_list">
            <tr>
                <th>SKU</th>
                <th>Title</th>
                <th>Barcode</th>
                <th colspan="3">Stock Level</th>
                <th></th>
            </tr>
        {% for product in product_range.products %}
        </tr>
            <td>{{ product.sku}}</td>
            <td><a href="{% url 'inventory:product' product.id %}">{{product.full_name}}</a></td>
            <td>{{product.barcode}}</td>
            <td><input id="stock_{{ product.id }}" type="text" value="{{ product.stock_level }}" size="4" /></td>
            <td><button id="update_{{ product.id }}" class="stock_update_button">Update Stock Level</button></td>
            <td><img id="status_{{ product.id }}" class="update_status" src=""></td>
            <td><a href="{% ccp_product_page product_range.id product.id %}" target="_blank"><button>View Product on Cloud Commerce</button></a></td>
        {% endfor %}
        </table>
    </div>
{% endblock %}

{% block script %}{{ block.super }}
    <script>
        loading_image = "{% static 'images/loading.gif' %}"
        complete_image = "{% static 'images/complete.jpg' %}"
        error_image = "{% static 'images/error.jpg' %}"
        update_stock_url = "{% url 'inventory:update_stock_level' %}";
        product_details = {
            {% for product in product_range.products %}
                '{{ product.id }}': {'stock_level': {{ product.stock_level }}},
            {% endfor %}
        }
    </script>
{% endblock %}
