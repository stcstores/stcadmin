{% extends "inventory/base.html" %}
{% load staticfiles %}
{% load cloud_commerce_extras %}

{% block additional_head %}
{{ block.super }}
<script src="{% static 'scripts/stock_manager.js' %}"></script>
{% endblock %}

{% block page_title %}CCP Stock Manager{% endblock %}

{% block content %}
    <form method="GET" action="">
        <label for="stock_search">Search</label>
        <input type="text" id="stock_search" name="search_text" value="{{ search_text }}">
        <input type="submit" id="stock_search_button" value="Search" />
    </form>
    <table id="stock_search_result">
        <thead>
            <tr>
                <th>SKU</th>
                <th>Name</th>
                <th><button id="show_hide_all">Show/Hide all</button></th>
            </tr>
        </thead>
            <tbody>
            {% for range in product_ranges %}
                <tr>
                    <td>{{ range.sku }}</td>
                    <td><a href="{% url 'inventory:product_range' range.id %}">{{ range.name }}</a></td>
                    <td class="products_box">
                        <span id="show_hide_products_{{ range.id }}" class="show_hide_products">[[ show ]]</span>
                        <table id="products_table_{{ range.id }}" class="products_table">
                            {% for product in range.products %}
                                <tr>
                                    <td>{{ product.full_name }}</td>
                                    <td><input id="stock_{{ product.id }}" type="text" value="{{ product.stock_level }}" size="4" /></td>
                                    <td><button id="update_{{ product.id }}" class="stock_update_button">Update Stock Level</button></td>
                                </tr>
                            {% endfor %}
                        </table>

                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block script %}
    <script>
        update_stock_url = "{% url 'cloud_commerce_api:update_stock_level' %}";
        product_details = {
            {% for range in product_ranges %}
            {% for product in range.products %}
                '{{ product.id }}': {'stock_level': {{ product.stock_level }}},
            {% endfor %}
            {% endfor %}
        }
    </script>
{% endblock %}
