 
{% include "django/forms/widgets/select.html" %}
<button class="btn btn-outline-secondary btn-sm"
        type="button"
        onclick="new_instance_dialogue_{{ widget.attrs.id }}();">New</button>

<script>
    function success_creating_{{ widget.attrs.id }}(result, status, xhr) {
        var instance_id = result['id'];
        var instance_name = result['name'];
        var input = $("#{{ widget.attrs.id }}");
        var newOption = new Option(instance_name, instance_id, false, true);
        input.append(newOption).trigger('change');
    }

    function error_creating_{{ widget.attrs.id }}(result, status, xhr) {
        alert("New {{ widget.name}} was not created.")
    }

    function new_instance_dialogue_{{ widget.attrs.id }}() {
        var new_name = prompt("Name of new {{ widget.name }}:", "");
        if (new_name) {
            $.ajax({
                url: "{{ create_new_url }}",
                method: "POST",
                data: {
                    'name': new_name
                },
                success: success_creating_{{ widget.attrs.id }},
                error: error_creating_{{ widget.attrs.id }},
            });
        }

    }
</script>
