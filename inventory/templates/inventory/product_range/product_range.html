{% extends "inventory/product_range/product_range_base.html" %}

{% block content %}
  {{ block.super }}
  <div class="container">
    {% if products_exist %}
      <div class="text-success">All products exist in Linnworks.</div>
    {% elif products_exist is None %}
      {% if product_range.is_active %}
        <div class="text-danger">
          <span class="fw-bold">Error checking for product in Linnworks.</span>
          This is likely due to a network error.
        </div>
      {% endif %}
    {% else %}
      <div class="text-warning">
        <span class="heading">This product cannot be found in Linnworks.</span>
        If it has recently been created or changed it is likely these changes have not yet been processed.
      </div>
    {% endif %}

    {% if product.is_end_of_line is False %}
      <div class="buttons">
        <a href="" class="button_link">
          <button>End-of-Line Range</button>
        </a>
      </div>
    {% endif %}

    <div>
      <h6 class="display-6 m-3">
        {% if product_range.has_variations %}
          Variations
        {% else %}
          Single Product
        {% endif %}
      </h6>
      <table class="table table-hover table-sm mt-3">
        <thead class="table-primary">
          <tr>
            <th>SKU</th>
            {% for option in product_range.variation_options %}<th>{{ option }}</th>{% endfor %}
            {% for option in product_range.listing_options %}<th>{{ option }}</th>{% endfor %}
            <th>Supplier SKU</th>
            <th colspan="2">
              {% if product_range.is_active %}
                <a href="{% url 'inventory:set_product_range_eol' product_range.pk %}"
                   class="btn btn-danger btn-sm">Set Range End of Line</a>
              {% endif %}
            </th>
            <th>Barcode</th>
            <th>Stock Level</th>
          </tr>
        </thead>
        <tbody>
          {% for product in product_range.products.variations %}
            <tr class="{% if product.is_archived %}table-secondary text-muted{% elif product.is_end_of_line %}table-secondary{% endif %}">
              <td class="font-monospace user-select-all">{{ product.sku }}</td>
              {% for option, value in product.variation.items %}<td class="user-select-all">{{ value }}</td>{% endfor %}
              {% for option, value in product.listing_options.items %}<td class="user-select-all">{{ value }}</td>{% endfor %}
              <td class="font-monospace user-select-all">{{ product.supplier_sku }}</td>
              <td>
                {% if product.is_archived %}
                  <span class="badge bg-secondary">Archived</span>
                {% elif product.is_end_of_line %}
                  <span class="badge bg-danger">End Of Line</span>
                {% endif %}
              </td>
              <td>
                {% if product.is_archived == False %}
                  <a href="{% url 'inventory:product' product.pk %}"
                     class="btn btn-primary btn-sm">Edit</a>
                  {% if product.is_end_of_line == False %}
                    <a href="{% url 'inventory:set_product_eol' product.pk %}"
                       class="btn btn-danger btn-sm">EOL</a>
                  {% endif %}
                {% endif %}
              </td>
              <td class="font-monospace user-select-all">{{ product.barcode }}</td>
              <td>{% include "inventory/update_stock.html" %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock content %}
