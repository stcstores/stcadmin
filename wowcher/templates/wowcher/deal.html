{% extends "wowcher/base.html" %}

{% block content %}{{ block.super }}
<h2>{{ deal }}</h2>

{% if deal.inactive %}
<div class="error">DISABLED</div>
{% elif deal.ended != None %}
<div>ENDED: {{ deal.ended }}</div>
{% else %}
<div>ACTIVE</div>
{% endif %}
<div>ID: {{ deal.deal_ID }}</div>
<div>{{ deal.name }}</div>
{% if stock_alerts %}
<div class=error>
  {{ stock_alert_count }} stock alert{{ stock_alert_count|pluralize }}
  ({{ hidden_stock_alert_count }} hidden)
</div>
{% endif %}

{% if deal.ended == None %}
<div class="update_deal">
  {% if deal.ended == None and deal.inactive %}
  <a href="{% url 'wowcher:enable_deal' deal.id %}" class="button_link">Enable</a>
  {% else %}
  <a href="{% url 'wowcher:disable_deal' deal.id %}" class="button_link">Disable</a>
  {% endif %}
  <a href="{% url 'wowcher:end_deal' deal.id %}" class="end_deal button_link">End</a>
</div>
{% endif %}
<br>
<h3>Variations</h3>
<div class="items">
{% for item in items %}
<div class="item">
  <div>Wowcher ID: {{ item.wowcher_ID }}</div>
  <div>SKU: {{ item.CC_SKU }}</div>
  {% for stock_alert in stock_alerts %}{% if stock_alert.item == item %}
    <div class="stock_alert">{{ stock_alert.stock_level }} Left</div>
  {% endif %}{% endfor %}
</div>
{% endfor %}
</div>
{% endblock %}

{% block script %}{{ block.super }}
  <script>
    $(document).ready(function() {
      $('.end_deal').click(function(e) {
        e.preventDefault();
        if (window.confirm("Are you sure you want to end '{{ deal }}'?")) {
          location.href = this.href;
        }
      });
    });
  </script>
{% endblock %}
